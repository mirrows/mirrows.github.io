(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[932],{2999:function(e,t,n){"use strict";var r=n(9499),c=n(4730),i=n(7294),u=n(5893),o=n(3454),a=["loadingPic","src","className","beforeLoad","onLoad","noReload","children","isShow"];function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.Z=function(e){var t=e.loadingPic,n=e.src,l=e.className,f=(e.beforeLoad,e.onLoad),d=void 0===f?function(e){return Promise.resolve(e)}:f,p=e.noReload,m=void 0!==p&&p,v=e.children,h=e.isShow,_=void 0===h||h,b=(0,c.Z)(e,a),w=(0,i.useRef)(t||"https://wsrv.nl/?url=raw.githubusercontent.com/mirrows/photo/main/normal/2023_09_10/pic1694333133502339.gif&w=130&fit=cover&n=-1&q=80"),g=(0,i.useRef)(o.env.NEXT_PUBLIC_FAIL_IMG),P=(0,i.useState)(w.current),O=P[0],x=P[1],j=(0,i.useState)(!1),y=j[0],k=j[1],L=(0,i.useRef)(null),Z=(0,i.useRef)(0);return(0,i.useEffect)(function(){if(!Z.current){var e,t,r=document.documentElement.clientHeight,c=document.documentElement.clientWidth;m||null===(e=L.current)||void 0===e||e.classList.add("lazy"),k(!1),L.current&&!(L.current.getBoundingClientRect().top<-L.current.clientHeight||L.current.getBoundingClientRect().top>1.5*r)&&!(L.current.getBoundingClientRect().left<-c||L.current.getBoundingClientRect().left>1.5*c)&&L.current.getBoundingClientRect().width&&L.current.getBoundingClientRect().height&&_&&(m&&(Z.current=1),null===(t=L.current)||void 0===t||t.classList.remove("lazy"),x(n))}},[n,_,m]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("img",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({className:"".concat(l?"lazy ".concat(l):"lazy"),ref:L,src:O,"data-src":n,alt:"",onLoad:function(){var e;k(!0),n===(null===(e=L.current)||void 0===e?void 0:e.src)&&d(n)},onError:function(){var e;null===(e=L.current)||void 0===e||e.classList.add("lazy"),x(g.current),k(!0)}},b)),y||v]})}},2561:function(e,t,n){"use strict";n.r(t);var r=n(7812),c=n(9499),i=n(29),u=n(4730),o=n(7794),a=n.n(o),s=n(2999),l=n(3806),f=n(7167),d=n(7989),p=n(8984),m=n(7294),v=n(931),h=n.n(v),_=n(5893),b=["list","mode","path","show","onPreview"];function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}t.default=(0,m.forwardRef)(function(e,t){var n,o=e.list,v=e.mode,w=void 0===v?f.VD.PHOTO:v,P=e.path,O=void 0===P?"normal/":P,x=e.show,j=void 0===x||x,y=e.onPreview,k=(0,u.Z)(e,b),L=(0,m.useState)(!1),Z=L[0],R=L[1],E=(0,m.useState)((void 0===o?[]:o)||[]),N=E[0],S=E[1],C=(0,m.useState)({}),D=C[0],I=C[1],X=(0,m.useRef)(0),B=(0,m.useRef)(1),T=(0,m.useState)(!1),V=T[0],z=T[1],q=(0,m.useRef)(Math.random()),H=(0,m.useRef)(!1),G=(0,m.useState)(!1),U=G[0],A=G[1],F=(0,m.useState)(""),M=F[0],Y=F[1],J=(0,m.useRef)(),W=(0,m.useRef)(null),K=(0,m.useState)(""),Q=K[0],$=K[1],ee=(0,m.useRef)(),et=(0,m.useCallback)((n=(0,i.Z)(a().mark(function e(t){var n,r,i;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n="","number"==typeof t?n=null===(r=N[t])||void 0===r?void 0:r.path:"string"==typeof t&&(n=t),n){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,(0,f.Zb)(n,w).catch(function(){});case 6:return i=e.sent,Y(""),I(function(e){return g(g({},e),{},(0,c.Z)({},n,(null==i?void 0:i.data)||(null==e?void 0:e[n])||[]))}),e.abrupt("return",(null==i?void 0:i.data)||[]);case 10:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)}),[N,w]),en=(0,m.useCallback)((0,i.Z)(a().mark(function e(){var t;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.Zb)(O,w);case 2:return t=e.sent.data,e.next=6,new Promise(function(e){setTimeout((0,i.Z)(a().mark(function n(){return a().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:S(t),e(t);case 2:case"end":return n.stop()}},n)})))});case 6:case"end":return e.stop()}},e)})),[O,w]),er=(0,m.useCallback)((0,i.Z)(a().mark(function e(){var t;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:X.current+=1,t=0;case 2:if(!(t<B.current)){e.next=8;break}return e.next=5,et(t+B.current*(X.current-1));case 5:t++,e.next=2;break;case 8:N.length<=X.current*B.current&&A(!0);case 9:case"end":return e.stop()}},e)})),[null==N?void 0:N.length,et]),ec=function(e,t){(0,f.Is)({path:t.path,sha:t.sha,mode:w}).then(function(t){et(e)})};(0,m.useImperativeHandle)(t,function(){var e;return{afterUpload:(e=(0,i.Z)(a().mark(function e(){return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,en();case 2:Y(0);case 3:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})}});var ei=function(e,t){null==y||y(e,t)},eu=(0,m.useCallback)((0,i.Z)(a().mark(function e(){var t,n,i;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=Object.keys(D),n=a().mark(function e(n){var i,u;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t[n],e.next=3,(0,f.Zb)(i,w);case 3:u=e.sent,I(function(e){return g(g({},e),{},(0,c.Z)({},i,(0,r.Z)(e[i].map(function(e){return g(g({},e),(null==u?void 0:u.data.find(function(t){return t.name===e.name}))||{})}))))});case 5:case"end":return e.stop()}},e)}),i=0;case 3:if(!(i<t.length)){e.next=8;break}return e.delegateYield(n(i),"t0",5);case 5:i++,e.next=3;break;case 8:case"end":return e.stop()}},e)})),[w,D]),eo=function(e,t){I(function(n){return g(g({},n),{},(0,c.Z)({},e,(0,r.Z)(n[e].map(function(e,n){return g(g({},e),{},{loaded:n===t||e.loaded||!1})}))))})};(0,m.useEffect)(function(){""!==M&&et(M)},[M,et]),(0,m.useEffect)(function(){H.current||(H.current=!0,en())},[en]),(0,m.useEffect)(function(){if(null!=N&&N.length){J.current=new IntersectionObserver((e=(0,i.Z)(a().mark(function e(t){var n,r;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t[0].intersectionRatio<=0)){e.next=2;break}return e.abrupt("return");case 2:return W.current&&(null===(n=J.current)||void 0===n||n.unobserve(W.current)),e.next=5,er();case 5:W.current&&(null===(r=J.current)||void 0===r||r.observe(W.current));case 6:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)}),{rootMargin:"500px 0px"}),W.current&&(null===(t=J.current)||void 0===t||t.observe(W.current));var e,t,n=W.current;return function(){var e,t;n&&(null===(e=J.current)||void 0===e||e.unobserve(n)),null===(t=J.current)||void 0===t||t.disconnect()}}},[null==N?void 0:N.length]),(0,m.useEffect)(function(){if(j)W.current&&(null===(e=J.current)||void 0===e||e.observe(W.current));else{W.current&&(null===(t=J.current)||void 0===t||t.unobserve(W.current));return}var e,t,n=W.current;return function(){var e,t;n&&(null===(e=J.current)||void 0===e||e.unobserve(n)),null===(t=J.current)||void 0===t||t.disconnect()}},[j]);var ea=(0,m.useCallback)(function(e){return"#".concat(String(q.current*(e+4)).slice(4,7))},[]);return(0,m.useEffect)(function(){p.SR.isGithubOwner(function(e){return R(e)})},[]),(0,m.useEffect)(function(){if(j&&"private"===w)return clearInterval(ee.current),ee.current=setInterval(function(){eu()},6e4),function(){clearInterval(ee.current)}},[w,eu,j]),(0,m.useEffect)(function(){z((0,d.tq)())},[]),(0,_.jsx)(_.Fragment,{children:(0,_.jsx)("div",g(g({},k),{},{children:(0,_.jsxs)("div",{className:h().picList,children:[(0,_.jsx)("div",{className:h().list_wrap,children:null==N?void 0:N.map(function(e,t){var n,r;return null!==(n=D[e.path])&&void 0!==n&&n.length?(0,_.jsxs)("div",{className:"".concat(h().time_fold_wrap).concat(X.current*B.current>t?"":" hide"),children:[(0,_.jsxs)("div",{className:h().timestone,children:[Z&&(0,_.jsx)("input",{type:"checkbox",className:h().if_del_btn,onChange:function(t){$(t.target.checked?e.name:"")}}),e.name]}),(0,_.jsx)("div",{className:h().pics_item_wrap,children:null===(r=D[e.path])||void 0===r?void 0:r.map(function(t,n){return(0,_.jsxs)("div",{className:h().pic_item_wrap,style:{backgroundColor:ea(n)},children:[Q===e.name&&(0,_.jsx)(l.Z,{className:h().img_del_btn,type:"close",onClick:function(){return ec(e.path,t)}}),(0,_.jsx)(s.Z,{className:h().img_item,src:"https://wsrv.nl/?url=".concat((t.download_url||"").replace("https://","")).concat(V?"&w=80&h=180":"&w=300","&fit=cover&n=-1&q=80"),width:"130",height:"320",noReload:!0,onLoad:function(t){eo(e.path,n)},onClick:function(){return ei(D[e.path],n)}})]},t.name)})})]},e.path):""})}),(0,_.jsx)("div",{ref:W,children:U||!N?(0,_.jsx)("div",{className:h().no_more_tips,children:"真的一点都没有了。。。。。。"}):(0,_.jsx)(l.Z,{className:"".concat(h().load_more_sign," rotate"),width:"48",type:"loading",fill:"gray"})})]})}))})})},7167:function(e,t,n){"use strict";n.d(t,{Is:function(){return l},P_:function(){return o},VD:function(){return c},Zb:function(){return a},iS:function(){return u},yJ:function(){return s}});var r,c,i=n(842);(r=c||(c={})).PHOTO="photo",r.PRIVATE="private";var u=function(e){return(0,i.Xv)({path:"/demos/uploadBase64",method:"put",headers:{timestamp:Date.now()},params:e})},o=function(e){return(0,i.Xv)({path:"/demos/uploadUrl",method:"put",headers:{timestamp:Date.now()},params:e})},a=function(e,t){return(0,i.Xv)({path:"/demos/queryPicList",method:"post",params:{path:e,mode:t}})},s=function(e,t){return(0,i.Xv)({path:"/demos/queryPic",method:"post",params:{path:e,mode:t}})},l=function(e){return(0,i.Xv)({path:"/demos/deletePic",method:"post",headers:{timestamp:Date.now()},params:e})}},8821:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/demos/imgSource/components/PicList",function(){return n(2561)}])},931:function(e){e.exports={picList:"PicList_picList__jiYUh",list_wrap:"PicList_list_wrap__2VsET",timestone:"PicList_timestone__zV1PX",time_fold_wrap:"PicList_time_fold_wrap__VGrwI",pics_item_wrap:"PicList_pics_item_wrap__xNoG8",img_item:"PicList_img_item__2dbAk",pic_item_wrap:"PicList_pic_item_wrap__mvLm5",img_del_btn:"PicList_img_del_btn__c9pjr",no_more_tips:"PicList_no_more_tips__Zrved",if_del_btn:"PicList_if_del_btn__Lm0pV"}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8821)}),_N_E=e.O()}]);