(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[932],{2561:function(e,t,n){"use strict";n.r(t);var r=n(7812),c=n(9499),u=n(29),i=n(4730),a=n(7794),o=n.n(a),s=n(3806),l=n(7167),f=n(7989),p=n(8984),d=n(7294),m=n(931),v=n.n(m),_=n(5893),h=["list","mode","path","show","onPreview"];function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}t.default=(0,d.forwardRef)(function(e,t){var n,a=e.list,m=e.mode,b=void 0===m?l.VD.PHOTO:m,x=e.path,g=void 0===x?"normal/":x,k=e.show,P=void 0===k||k,j=e.onPreview,O=(0,i.Z)(e,h),y=(0,d.useState)(!1),Z=y[0],L=y[1],N=(0,d.useState)((void 0===a?[]:a)||[]),E=N[0],S=N[1],C=(0,d.useState)({}),R=C[0],D=C[1],I=(0,d.useRef)(0),X=(0,d.useRef)(1),T=(0,d.useState)(!1),V=T[0],q=T[1],G=(0,d.useRef)(Math.random()),H=(0,d.useRef)(!1),U=(0,d.useState)(!1),A=U[0],M=U[1],Y=(0,d.useState)(""),z=Y[0],B=Y[1],F=(0,d.useRef)(),J=(0,d.useRef)(null),K=(0,d.useState)(""),Q=K[0],W=K[1],$=(0,d.useRef)(),ee=(0,d.useCallback)((n=(0,u.Z)(o().mark(function e(t){var n,r,u;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n="","number"==typeof t?n=null===(r=E[t])||void 0===r?void 0:r.path:"string"==typeof t&&(n=t),n){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,(0,l.Zb)(n,b).catch(function(){});case 6:return u=e.sent,B(""),D(function(e){return w(w({},e),{},(0,c.Z)({},n,(null==u?void 0:u.data)||(null==e?void 0:e[n])||[]))}),e.abrupt("return",(null==u?void 0:u.data)||[]);case 10:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)}),[E,b]),et=(0,d.useCallback)((0,u.Z)(o().mark(function e(){var t;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.Zb)(g,b);case 2:return t=e.sent.data,e.next=6,new Promise(function(e){setTimeout((0,u.Z)(o().mark(function n(){return o().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:S(t),e(t);case 2:case"end":return n.stop()}},n)})))});case 6:case"end":return e.stop()}},e)})),[g,b]),en=(0,d.useCallback)((0,u.Z)(o().mark(function e(){var t;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:I.current+=1,t=0;case 2:if(!(t<X.current)){e.next=8;break}return e.next=5,ee(t+X.current*(I.current-1));case 5:t++,e.next=2;break;case 8:E.length<=I.current*X.current&&M(!0);case 9:case"end":return e.stop()}},e)})),[null==E?void 0:E.length,ee]),er=function(e,t){(0,l.Is)({path:t.path,sha:t.sha,mode:b}).then(function(t){ee(e)})};(0,d.useImperativeHandle)(t,function(){var e;return{afterUpload:(e=(0,u.Z)(o().mark(function e(){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,et();case 2:B(0);case 3:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})}});var ec=function(e,t){null==j||j(e,t)},eu=(0,d.useCallback)((0,u.Z)(o().mark(function e(){var t,n,u;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=Object.keys(R),n=o().mark(function e(n){var u,i;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(R[u=t[n]].some(function(e){return!e.loaded})){e.next=4;break}return e.abrupt("return","continue");case 4:return e.next=6,(0,l.Zb)(u,b);case 6:i=e.sent,D(function(e){return w(w({},e),{},(0,c.Z)({},u,(0,r.Z)(e[u].map(function(e){return w(w({},e),(null==i?void 0:i.data.find(function(t){return t.name===e.name}))||{})}))))});case 8:case"end":return e.stop()}},e)}),u=0;case 3:if(!(u<t.length)){e.next=11;break}return e.delegateYield(n(u),"t0",5);case 5:if("continue"!==e.t0){e.next=8;break}return e.abrupt("continue",8);case 8:u++,e.next=3;break;case 11:case"end":return e.stop()}},e)})),[b,R]),ei=function(e,t){D(function(n){return w(w({},n),{},(0,c.Z)({},e,(0,r.Z)(n[e].map(function(e,n){return w(w({},e),{},{loaded:n===t||e.loaded||!1})}))))})};(0,d.useEffect)(function(){""!==z&&ee(z)},[z,ee]),(0,d.useEffect)(function(){H.current||(H.current=!0,et())},[et]),(0,d.useEffect)(function(){if(null!=E&&E.length){F.current=new IntersectionObserver((e=(0,u.Z)(o().mark(function e(t){var n,r;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t[0].intersectionRatio<=0)){e.next=2;break}return e.abrupt("return");case 2:return J.current&&(null===(n=F.current)||void 0===n||n.unobserve(J.current)),e.next=5,en();case 5:J.current&&(null===(r=F.current)||void 0===r||r.observe(J.current));case 6:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)}),{rootMargin:"500px 0px"}),J.current&&(null===(t=F.current)||void 0===t||t.observe(J.current));var e,t,n=J.current;return function(){var e,t;n&&(null===(e=F.current)||void 0===e||e.unobserve(n)),null===(t=F.current)||void 0===t||t.disconnect()}}},[null==E?void 0:E.length]),(0,d.useEffect)(function(){if(P)J.current&&(null===(e=F.current)||void 0===e||e.observe(J.current));else{J.current&&(null===(t=F.current)||void 0===t||t.unobserve(J.current));return}var e,t,n=J.current;return function(){var e,t;n&&(null===(e=F.current)||void 0===e||e.unobserve(n)),null===(t=F.current)||void 0===t||t.disconnect()}},[P]);var ea=(0,d.useCallback)(function(e){return"#".concat(String(G.current*(e+4)).slice(4,7))},[]);return(0,d.useEffect)(function(){p.SR.isGithubOwner(function(e){return L(e)})},[]),(0,d.useEffect)(function(){if(P&&"private"===b)return clearInterval($.current),$.current=setInterval(function(){eu()},18e4),function(){clearInterval($.current)}},[b,eu,P]),(0,d.useEffect)(function(){q((0,f.tq)())},[]),(0,_.jsx)(_.Fragment,{children:(0,_.jsx)("div",w(w({},O),{},{children:(0,_.jsxs)("div",{className:v().picList,children:[(0,_.jsx)("div",{className:v().list_wrap,children:null==E?void 0:E.map(function(e,t){var n,r;return null!==(n=R[e.path])&&void 0!==n&&n.length?(0,_.jsxs)("div",{className:"".concat(v().time_fold_wrap).concat(I.current*X.current>t?"":" hide"),children:[(0,_.jsxs)("div",{className:v().timestone,children:[Z&&(0,_.jsx)("input",{type:"checkbox",className:v().if_del_btn,onChange:function(t){W(t.target.checked?e.name:"")}}),e.name]}),(0,_.jsx)("div",{className:v().pics_item_wrap,children:null===(r=R[e.path])||void 0===r?void 0:r.map(function(t,n){return(0,_.jsxs)("div",{className:v().pic_item_wrap,style:{backgroundColor:ea(n)},children:[Q===e.name&&(0,_.jsx)(s.Z,{className:v().img_del_btn,type:"close",onClick:function(){return er(e.path,t)}}),(0,_.jsx)("img",{className:v().img_item,src:"https://wsrv.nl/?url=".concat((t.download_url||"").replace("https://","")).concat(V?"&w=160&h=360":"&w=280","&fit=cover&n=-1&q=80"),width:"130",height:"320",alt:"",onLoad:function(t){ei(e.path,n)},onClick:function(){return ec(R[e.path],n)}})]},t.name)})})]},e.path):""})}),(0,_.jsx)("div",{ref:J,children:A||!E?(0,_.jsx)("div",{className:v().no_more_tips,children:"真的一点都没有了。。。。。。"}):(0,_.jsx)(s.Z,{className:"".concat(v().load_more_sign," rotate"),width:"48",type:"loading",fill:"gray"})})]})}))})})},7167:function(e,t,n){"use strict";n.d(t,{Is:function(){return l},P_:function(){return a},VD:function(){return c},Zb:function(){return o},iS:function(){return i},yJ:function(){return s}});var r,c,u=n(842);(r=c||(c={})).PHOTO="photo",r.PRIVATE="private";var i=function(e){return(0,u.Xv)({path:"/demos/uploadBase64",method:"put",headers:{timestamp:Date.now()},params:e})},a=function(e){return(0,u.Xv)({path:"/demos/uploadUrl",method:"put",headers:{timestamp:Date.now()},params:e})},o=function(e,t){return(0,u.Xv)({path:"/demos/queryPicList",method:"post",params:{path:e,mode:t}})},s=function(e,t){return(0,u.Xv)({path:"/demos/queryPic",method:"post",params:{path:e,mode:t}})},l=function(e){return(0,u.Xv)({path:"/demos/deletePic",method:"post",headers:{timestamp:Date.now()},params:e})}},8821:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/demos/imgSource/components/PicList",function(){return n(2561)}])},931:function(e){e.exports={picList:"PicList_picList__jiYUh",list_wrap:"PicList_list_wrap__2VsET",timestone:"PicList_timestone__zV1PX",time_fold_wrap:"PicList_time_fold_wrap__VGrwI",pics_item_wrap:"PicList_pics_item_wrap__xNoG8",img_item:"PicList_img_item__2dbAk",pic_item_wrap:"PicList_pic_item_wrap__mvLm5",img_del_btn:"PicList_img_del_btn__c9pjr",no_more_tips:"PicList_no_more_tips__Zrved",if_del_btn:"PicList_if_del_btn__Lm0pV"}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8821)}),_N_E=e.O()}]);