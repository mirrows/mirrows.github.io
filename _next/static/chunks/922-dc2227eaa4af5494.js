"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[922],{9922:function(t,e,n){var r=n(9499),o=n(29),i=n(7812),a=n(4730),c=n(7794),l=n.n(c),s=n(7167),u=n(7989),p=n(3290),d=n(7294),f=n(9521),m=n(3806),h=n(3243),g=n(5893),b=["clickable","children","operateLine","autoUpload","onStartUpload","personal","onFinish","className","allowUrl","allowClick","align"];function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach(function(e){(0,r.Z)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var y=f.ZP.div.withConfig({displayName:"ImgUpload__DIV",componentId:"sc-6cvirj-0"})(["&.con_input_wrap{display:flex;flex-direction:column;height:100%;}.up_operate_bottom,.up_operate_top{display:flex;justify-content:space-between;align-items:center;height:fit-content;min-height:26px;margin-top:10px;text-align:left;}.up_operate_top{order:-1;margin-top:0;margin-bottom:10px;}.url_input_wrap{display:inline-block;position:relative;vertical-align:middle;.url_input_wrap{margin-right:10px;}.url_input{flex:1 1 0;width:100%;height:100%;padding-right:36px;box-sizing:border-box;font-size:12px;}.enter_icon{position:absolute;right:3px;top:0;bottom:0;height:12px;width:12px;padding:4px;background-color:#000;border-radius:4px;margin:auto;fill:#fff;}}.file_wrap{display:inline-block;padding:0 8px;margin:0 10px;white-space:nowrap;font-size:1rem;color:gray;}.tmp_wrap{display:flex;flex-wrap:wrap;max-height:215px;}.tmp_item_wrap{position:relative;}.tmp_item{width:40px;height:96px;object-fit:cover;margin:5px;}.tmp_del_btn{position:absolute;right:0;top:0;width:15px;padding:0 0 5px 5px;border-radius:0 0 0 20px;fill:#fff;background-color:#000;}.tmp_status_btn{position:absolute;left:5px;bottom:5px;width:20px;}.submit_btn{float:right;}.upload_children_wrap{height:100%;}"]),_=(0,d.forwardRef)(function(t,e){var n,r,c,f,w=t.clickable,_=void 0===w||w,x=t.children,j=(t.operateLine,t.autoUpload),O=void 0!==j&&j,k=t.onStartUpload,R=void 0===k?function(){}:k,S=t.personal,P=void 0!==S&&S,N=t.onFinish,E=void 0===N?function(){}:N,D=t.className,Z=void 0===D?"":D,C=t.allowUrl,I=t.allowClick,z=void 0===I||I,A=t.align,L=(0,a.Z)(t,b),T=(0,d.useRef)(null),U=(0,d.useRef)(null),M=(0,d.useState)([]),Y=M[0],q=M[1],B=(0,d.useState)([]),F=B[0],G=B[1],H=(0,d.useState)(""),V=H[0],W=H[1],J=(0,d.useState)(!1),K=J[0],X=J[1],Q=(0,d.useRef)(P),$=(0,d.useRef)(null),tt=(0,d.useRef)((null===(c=window)||void 0===c?void 0:c.URL)||(null===(f=window)||void 0===f?void 0:f.webkitURL)),te=(0,d.useMemo)(function(){return[].concat((0,i.Z)(Y.map(function(t){var e,n=(null===(e=tt.current)||void 0===e?void 0:e.createObjectURL(t))||"";return{id:btoa(encodeURI(t.name+t.type+t.size)),type:"file",src:n}})),(0,i.Z)(F.map(function(t){return{id:t.slice(30,50),type:"url",src:t}})))},[F,Y]),tn=(0,d.useState)({}),tr=tn[0],to=tn[1],ti=function(){var t;null===(t=U.current)||void 0===t||t.click()},ta=(n=(0,o.Z)(l().mark(function t(e,n,r,o){var i,a,c;return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.type.match("gif")&&!r.match("mini"))){t.next=4;break}t.t0=e,t.next=7;break;case 4:return t.next=6,(0,p.el)(e,n);case 6:t.t0=t.sent;case 7:return i=t.t0,t.next=10,(0,p.Uc)(i);case 10:return a=t.sent,t.next=13,(0,s.iS)({content:a.split(",")[1],path:r,mode:o});case 13:return c=t.sent,t.abrupt("return",c);case 15:case"end":return t.stop()}},t)})),function(t,e,r,o){return n.apply(this,arguments)}),tc=(r=(0,o.Z)(l().mark(function t(e){var n,r,o,i,a,c,p,d,f,m,h,g,b,w;return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(o in null==e||e.stopPropagation(),X(!0),R(),Q.current=P,n=Q.current?s.VD.PRIVATE:s.VD.PHOTO,r={},tr)r[o]="WAIT";to(v({},r)),i=[],a=0;case 10:if(!(a<Y.length)){t.next=25;break}return c="pic"+Date.now()+String(Math.random()).slice(4,7)+"."+Y[a].name.split(".").reverse()[0],p="".concat((0,u.ED)(new Date,"YYYY_MM_DD"),"/").concat(c),d="LOADING",r[te[a].id]=d,to(v({},r)),t.next=18,ta(Y[a],{quality:2097152>Y[a].size?2097152/Y[a].size:.8},"normal/".concat(p),n);case 18:!(null!=(f=t.sent)&&f.data)||null!=f&&f.code?d="ERROR":i.push({normal:f.data}),r[te[a].id]="LOADING"===d?"SUCCESS":d,to(v({},r));case 22:a++,t.next=10;break;case 25:m=0;case 26:if(!(m<F.length)){t.next=42;break}return h="LOADING",r[te[m+Y.length].id]=h,to(v({},r)),g="pic"+Date.now()+String(Math.random()).slice(4,7),b="".concat((0,u.ED)(new Date,"YYYY_MM_DD"),"/").concat(g),t.next=34,(0,s.P_)({url:F[m],path:"normal/".concat(b),mode:n});case 34:w=t.sent,i.push({normal:w.data}),w.code&&(h="ERROR"),r[te[m+Y.length].id]="LOADING"===h?"SUCCESS":h,to(v({},r));case 39:m++,t.next=26;break;case 42:E(i),G(function(t){return t.filter(function(t,e){return"ERROR"===r[te[e+Y.length].id]})}),q(function(t){return t.filter(function(t,e){return"ERROR"===r[te[e].id]})}),U.current&&(U.current.value=""),X(!1);case 47:case"end":return t.stop()}},t)})),function(t){return r.apply(this,arguments)}),tl=function(){V&&(G(function(t){return Array.from(new Set([].concat((0,i.Z)(t),(0,i.Z)(V.split(",")))))}),W(""))},ts=function(t,e){"file"===t.type?q(function(t){var n=(0,i.Z)(t);return n.splice(e,1),n}):"url"===t.type&&G(function(t){var n=(0,i.Z)(t);return n.splice(e-Y.length,1),n})},tu=function(t){var e;null===(e=$.current)||void 0===e||e.open(te.map(function(e){return{cdn_url:e.src,sha:Date.now().toString()+t}}),t)},tp=function(t){q(function(e){return[].concat((0,i.Z)(e),(0,i.Z)(t))})};return(0,d.useImperativeHandle)(e,function(){return{addFile:tp}}),(0,d.useEffect)(function(){var t=tt.current;return function(){te.forEach(function(e){"file"===e.type&&e.src&&(null==t||t.revokeObjectURL(e.src))})}},[te]),(0,d.useEffect)(function(){!Y.length&&U.current&&(U.current.value="")},[Y]),(0,d.useEffect)(function(){O&&te.length&&tc(),to(function(t){var e={};return te.forEach(function(n){e[n.id]=t[n.id]||"WAIT"}),e})},[te,O]),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(y,v(v({ref:T,className:"con_input_wrap".concat(Z?" ".concat(Z):"")},L),{},{onClick:function(){return z&&_&&ti()},onDrop:function(t){var e;t.preventDefault(),t.stopPropagation(),(null===(e=t.dataTransfer.files)||void 0===e?void 0:e.length)&&q(function(e){return[].concat((0,i.Z)(e),(0,i.Z)(Array.from(t.dataTransfer.files)))})},onDragOver:function(t){return t.preventDefault()},children:[Array.isArray(x)?(0,d.cloneElement)(x[0],v(v({},x[0].props),{},{className:"upload_children_wrap ".concat(x[0].props.className||"").concat(te.length?" hide":"")})):(0,d.cloneElement)(x,v(v({},x.props),{},{className:"upload_children_wrap ".concat(x.props.className||"").concat(te.length?" hide":"")})),(0,g.jsx)("input",{ref:U,type:"file",name:"",id:"",multiple:!0,accept:"image/*",style:{display:"none"},onChange:function(t){var e;(null===(e=t.target.files)||void 0===e?void 0:e.length)&&q((0,i.Z)(Array.from(t.target.files)))}}),(0,g.jsx)("div",{className:"scroll_er tmp_wrap",children:te.map(function(t,e){return(0,g.jsxs)("div",{className:"tmp_item_wrap upload_".concat(tr[t.id]),onClick:function(t){return t.stopPropagation()},children:[(0,g.jsx)("img",{className:"tmp_item",width:"40",height:"96",src:t.src,alt:"",onClick:function(){return tu(e)}}),K||(0,g.jsx)(m.Z,{className:"tmp_del_btn",type:"close",onClick:function(){return ts(t,e)}}),{SUCCESS:(0,g.jsx)(m.Z,{className:"tmp_status_btn",type:"yes",fill:"green"}),ERROR:(0,g.jsx)(m.Z,{className:"tmp_status_btn",type:"no",fill:"red"}),WAIT:"",LOADING:(0,g.jsx)(m.Z,{className:"tmp_status_btn rotate",type:"loading",fill:"gray"})}[tr[t.id]]]},t.id)})}),(0,g.jsxs)("div",{className:"up_operate_".concat(void 0===A?"bottom":A),children:[(0,g.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[z&&_||(0,g.jsx)(m.Z,{width:26,type:"image",style:{marginRight:"10px"},onClick:ti}),(void 0===C||C)&&(0,g.jsxs)("div",{className:"url_input_wrap",onClick:function(t){return t.stopPropagation()},children:[(0,g.jsx)("input",{className:"normal_input url_input",type:"text",placeholder:"".concat(te.length||0," pics will be uploaded"),value:V,onInput:function(t){return W(t.currentTarget.value)},onKeyUp:function(t){"Enter"===t.key&&tl()}}),(0,g.jsx)(m.Z,{className:"enter_icon",type:"enter",onClick:tl})]})]}),O||!!te.length&&(0,g.jsx)("button",{className:"normal_btn submit_btn",onClick:tc,children:"upload"}),Array.isArray(x)?(0,d.cloneElement)(x[1],v({},x[1].props)):""]})]})),(0,g.jsx)(h.Z,{ref:$,slice:!1})]})});_.displayName="ImgUpload",e.Z=_},2999:function(t,e,n){var r=n(9499),o=n(4730),i=n(7294),a=n(5893),c=n(3454),l=["loadingPic","src","className","beforeLoad","noReload","children","isShow"];function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}e.Z=function(t){var e=t.loadingPic,n=t.src,u=t.className,p=(t.beforeLoad,t.noReload),d=void 0!==p&&p,f=t.children,m=t.isShow,h=void 0===m||m,g=(0,o.Z)(t,l),b=(0,i.useRef)(e||"https://wsrv.nl/?url=raw.githubusercontent.com/mirrows/photo/main/normal/2023_09_10/pic1694333133502339.gif&w=130&fit=cover&n=-1&q=80"),w=(0,i.useRef)(c.env.NEXT_FAIL_IMG),v=(0,i.useState)(b.current),y=v[0],_=v[1],x=(0,i.useState)(!1),j=x[0],O=x[1],k=(0,i.useRef)(null),R=(0,i.useRef)(0);return(0,i.useEffect)(function(){if(console.log(d,R.current),!R.current){var t,e,r=document.documentElement.clientHeight,o=document.documentElement.clientWidth;d||null===(t=k.current)||void 0===t||t.classList.add("lazy"),O(!1),k.current&&!(k.current.getBoundingClientRect().top<-k.current.clientHeight||k.current.getBoundingClientRect().top>1.5*r)&&!(k.current.getBoundingClientRect().left<-o||k.current.getBoundingClientRect().left>1.5*o)&&k.current.getBoundingClientRect().width&&k.current.getBoundingClientRect().height&&h&&(d&&(R.current=1),null===(e=k.current)||void 0===e||e.classList.remove("lazy"),_(n))}},[n,h,d]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("img",function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach(function(e){(0,r.Z)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({className:"".concat(u?"lazy ".concat(u):"lazy"),ref:k,src:y,"data-src":n,alt:"",onLoad:function(){return O(!0)},onError:function(){var t;null===(t=k.current)||void 0===t||t.classList.add("lazy"),_(w.current),O(!0)}},g)),j||f]})}},3243:function(t,e,n){var r=n(2379),o=n(2999),i=n(9521),a=n(7294),c=n(3290),l=n(7989),s=n(3806);n(995);var u=n(5893),p=i.ZP.div.withConfig({displayName:"PicModal__PIC",componentId:"sc-l89lay-0"})(["&.imgs_wrap{position:fixed;top:0;bottom:0;left:0;right:0;background-color:#666;z-index:-10;opacity:0;transition:.3s;}.pic_wrap{display:flex;justify-content:center;align-items:center;padding:30px;margin:auto;box-sizing:border-box;}.pic_item{width:unset;height:unset;max-width:100%;max-height:100%;}.swiper_header{display:flex;flex-wrap:nowrap;justify-content:space-between;align-items:center;position:absolute;top:0;left:0;width:100%;height:fit-content;padding:10px;background-image:linear-gradient(black 0%,transparent 80%);box-sizing:border-box;color:#fff;z-index:80;.name{line-height:1;}}.modal_wrap{}.img_swiper_wrap{width:100%;height:100%;}.img_swiper_wrap .tmp_status_btn{position:absolute;width:64px;z-index:-1;}&.flow_up{opacity:1;z-index:60;}"]),d=(0,a.forwardRef)(function(t,e){var n,i=t.pics,d=t.slice,f=void 0===d||d,m=t.onChange,h=void 0===m?function(){}:m,g=t.beforeLoad,b=void 0===g?function(t){return Promise.resolve(t)}:g,w=(0,a.useState)(!1),v=w[0],y=w[1],_=(0,a.useRef)(null),x=(0,a.useState)(0),j=x[0],O=x[1],k=(0,a.useState)(!1),R=k[0],S=k[1],P=(0,c.wo)(".img_swiper_wrap .lazy").emit,N=(0,a.useState)(i||[]),E=N[0],D=N[1],Z=(0,a.useRef)({obj:"body",val:0}),C=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;D(t),O(n),_.current?(null===(e=_.current)||void 0===e||e.slideTo(n),setTimeout(function(){y(!0)},300)):setTimeout(function(){var t;null===(t=_.current)||void 0===t||t.slideTo(n),setTimeout(function(){y(!0)},2e3)},500)},I=function(){D([]),y(!1)};return(0,a.useImperativeHandle)(e,function(){return{open:C,close:I}}),(0,a.useEffect)(function(){i&&D(i)},[i]),(0,a.useEffect)(function(){S((0,l.tq)())},[]),(0,a.useEffect)(function(){if(v)document.body.scrollTop?Z.current={obj:"body",val:document.body.scrollTop}:document.documentElement.scrollTop&&(Z.current={obj:"documentElement",val:document.documentElement.scrollTop}),document.body.classList.add("disabled_scroll"),P();else{if(D([]),document.body.classList.remove("disabled_scroll"),!Z.current.val)return;document[Z.current.obj].scrollTop=Z.current.val,Z.current.val=0}},[v,P]),(0,u.jsxs)(p,{className:"imgs_wrap".concat(v?" flow_up":""),onScroll:function(t){t.stopPropagation()},onWheel:function(t){t.stopPropagation()},children:[(0,u.jsxs)("div",{className:"swiper_header",children:[(0,u.jsx)("span",{className:"name",children:(null===(n=E[j])||void 0===n?void 0:n.name)||""}),(0,u.jsx)(s.Z,{type:"close",width:"30",height:"30",fill:"#fff",className:"close_swiper",onClick:function(){return y(!1)}})]}),(0,u.jsx)(r.tq,{loop:!0,className:"img_swiper_wrap",onSwiper:function(t){return _.current=t},onSlideChangeTransitionEnd:function(t){O(t.realIndex),h(),P()},children:E.map(function(t,e){return(0,u.jsx)(r.o5,{className:"pic_wrap",children:(0,u.jsx)(o.Z,{src:f?"https://wsrv.nl/?url=".concat((t.preview_url||t.download_url||"").replace("https://","")).concat(R?"&w=240":"","&n=-1&q=80"):t.cdn_url||"",className:"pic_item",width:"1920",height:"1080",alt:"bing",beforeLoad:b,children:(0,u.jsx)(s.Z,{className:"tmp_status_btn rotate",type:"loading",fill:"#fff"})})},e)})})]})});d.displayName="PicModal",e.Z=d},7167:function(t,e,n){n.d(e,{Is:function(){return m},P_:function(){return p},VD:function(){return o},Zb:function(){return d},iS:function(){return u},yJ:function(){return f}});var r,o,i=n(9499),a=n(842),c=n(8984);function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach(function(e){(0,i.Z)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}(r=o||(o={})).PHOTO="photo",r.PRIVATE="private";var u=function(t){return(0,a.IO)({path:"/demos/uploadBase64",method:"put",headers:s({timestamp:Date.now(),"content-type":"application/json"},c.SR.data.token?{Authorization:"token ".concat(c.SR.data.token)}:{}),params:t})},p=function(t){return(0,a.IO)({path:"/demos/uploadUrl",method:"put",headers:s({timestamp:Date.now(),"content-type":"application/json"},c.SR.data.token?{Authorization:"token ".concat(c.SR.data.token)}:{}),params:t})},d=function(t,e){return(0,a.IO)({path:"/demos/queryPicList",method:"post",headers:s({"content-type":"application/json"},c.SR.data.token?{Authorization:"token ".concat(c.SR.data.token)}:{}),params:{path:t,mode:e}})},f=function(t,e){return(0,a.IO)({path:"/demos/queryPic",method:"post",headers:s({"content-type":"application/json"},c.SR.data.token?{Authorization:"token ".concat(c.SR.data.token)}:{}),params:{path:t,mode:e}})},m=function(t){return(0,a.IO)({path:"/demos/deletePic",method:"post",headers:s({timestamp:Date.now(),"content-type":"application/json"},c.SR.data.token?{Authorization:"token ".concat(c.SR.data.token)}:{}),params:t})}}}]);