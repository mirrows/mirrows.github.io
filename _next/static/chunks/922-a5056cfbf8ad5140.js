"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[922],{9922:function(e,t,n){var r=n(9499),o=n(29),i=n(7812),a=n(4730),c=n(7794),l=n.n(c),s=n(7167),u=n(7989),p=n(3290),d=n(7294),f=n(9521),m=n(3806),h=n(3243),g=n(5893),b=["clickable","children","operateLine","autoUpload","onStartUpload","personal","onFinish","className","allowUrl","allowClick","align"];function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=f.ZP.div.withConfig({displayName:"ImgUpload__DIV",componentId:"sc-6cvirj-0"})(["&.con_input_wrap{display:flex;flex-direction:column;height:100%;}.up_operate_bottom,.up_operate_top{display:flex;justify-content:space-between;align-items:center;height:fit-content;min-height:26px;margin-top:10px;text-align:left;}.up_operate_top{order:-1;margin-top:0;margin-bottom:10px;}.url_input_wrap{display:inline-block;position:relative;vertical-align:middle;.url_input_wrap{margin-right:10px;}.url_input{flex:1 1 0;width:100%;height:100%;padding-right:36px;box-sizing:border-box;font-size:12px;}.enter_icon{position:absolute;right:3px;top:0;bottom:0;height:12px;width:12px;padding:4px;background-color:#000;border-radius:4px;margin:auto;fill:#fff;}}.file_wrap{display:inline-block;padding:0 8px;margin:0 10px;white-space:nowrap;font-size:1rem;color:gray;}.tmp_wrap{display:flex;flex-wrap:wrap;max-height:215px;}.tmp_item_wrap{position:relative;}.tmp_item{width:40px;height:96px;object-fit:cover;margin:5px;}.tmp_del_btn{position:absolute;right:0;top:0;width:15px;padding:0 0 5px 5px;border-radius:0 0 0 20px;fill:#fff;background-color:#000;}.tmp_status_btn{position:absolute;left:5px;bottom:5px;width:20px;}.submit_btn{float:right;}.upload_children_wrap{height:100%;}"]),_=(0,d.forwardRef)(function(e,t){var n,r,c,f,v=e.clickable,_=void 0===v||v,x=e.children,j=(e.operateLine,e.autoUpload),O=void 0!==j&&j,k=e.onStartUpload,R=void 0===k?function(){}:k,S=e.personal,P=void 0!==S&&S,N=e.onFinish,E=void 0===N?function(){}:N,D=e.className,Z=void 0===D?"":D,C=e.allowUrl,I=e.allowClick,L=void 0===I||I,z=e.align,A=(0,a.Z)(e,b),T=(0,d.useRef)(null),U=(0,d.useRef)(null),M=(0,d.useState)([]),Y=M[0],q=M[1],B=(0,d.useState)([]),F=B[0],G=B[1],H=(0,d.useState)(""),V=H[0],W=H[1],J=(0,d.useState)(!1),K=J[0],X=J[1],Q=(0,d.useRef)(P),$=(0,d.useRef)(null),ee=(0,d.useRef)((null===(c=window)||void 0===c?void 0:c.URL)||(null===(f=window)||void 0===f?void 0:f.webkitURL)),et=(0,d.useMemo)(function(){return[].concat((0,i.Z)(Y.map(function(e){var t,n=(null===(t=ee.current)||void 0===t?void 0:t.createObjectURL(e))||"";return{id:btoa(encodeURI(e.name+e.type+e.size)),type:"file",src:n}})),(0,i.Z)(F.map(function(e){return{id:e.slice(30,50),type:"url",src:e}})))},[F,Y]),en=(0,d.useState)({}),er=en[0],eo=en[1],ei=function(){var e;null===(e=U.current)||void 0===e||e.click()},ea=(n=(0,o.Z)(l().mark(function e(t,n,r,o){var i,a,c;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.type.match("gif")&&!r.match("mini"))){e.next=4;break}e.t0=t,e.next=7;break;case 4:return e.next=6,(0,p.el)(t,n);case 6:e.t0=e.sent;case 7:return i=e.t0,e.next=10,(0,p.Uc)(i);case 10:return a=e.sent,e.next=13,(0,s.iS)({content:a.split(",")[1],path:r,mode:o});case 13:return c=e.sent,e.abrupt("return",c);case 15:case"end":return e.stop()}},e)})),function(e,t,r,o){return n.apply(this,arguments)}),ec=(r=(0,o.Z)(l().mark(function e(t){var n,r,o,i,a,c,p,d,f,m,h,g,b,v;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o in null==t||t.stopPropagation(),X(!0),R(),Q.current=P,n=Q.current?s.VD.PRIVATE:s.VD.PHOTO,r={},er)r[o]="WAIT";eo(w({},r)),i=[],a=0;case 10:if(!(a<Y.length)){e.next=25;break}return c="pic"+Date.now()+String(Math.random()).slice(4,7)+"."+Y[a].name.split(".").reverse()[0],p="".concat((0,u.ED)(new Date,"YYYY_MM_DD"),"/").concat(c),d="LOADING",r[et[a].id]=d,eo(w({},r)),e.next=18,ea(Y[a],{quality:2097152>Y[a].size?2097152/Y[a].size:.8},"normal/".concat(p),n);case 18:!(null!=(f=e.sent)&&f.data)||null!=f&&f.code?d="ERROR":i.push({normal:f.data}),r[et[a].id]="LOADING"===d?"SUCCESS":d,eo(w({},r));case 22:a++,e.next=10;break;case 25:m=0;case 26:if(!(m<F.length)){e.next=42;break}return h="LOADING",r[et[m+Y.length].id]=h,eo(w({},r)),g="pic"+Date.now()+String(Math.random()).slice(4,7),b="".concat((0,u.ED)(new Date,"YYYY_MM_DD"),"/").concat(g),e.next=34,(0,s.P_)({url:F[m],path:"normal/".concat(b),mode:n});case 34:v=e.sent,i.push({normal:v.data}),v.code&&(h="ERROR"),r[et[m+Y.length].id]="LOADING"===h?"SUCCESS":h,eo(w({},r));case 39:m++,e.next=26;break;case 42:E(i),G(function(e){return e.filter(function(e,t){return"ERROR"===r[et[t+Y.length].id]})}),q(function(e){return e.filter(function(e,t){return"ERROR"===r[et[t].id]})}),U.current&&(U.current.value=""),X(!1);case 47:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)}),el=function(){V&&(G(function(e){return Array.from(new Set([].concat((0,i.Z)(e),(0,i.Z)(V.split(",")))))}),W(""))},es=function(e,t){"file"===e.type?q(function(e){var n=(0,i.Z)(e);return n.splice(t,1),n}):"url"===e.type&&G(function(e){var n=(0,i.Z)(e);return n.splice(t-Y.length,1),n})},eu=function(e){var t;null===(t=$.current)||void 0===t||t.open(et.map(function(t){return{cdn_url:t.src,sha:Date.now().toString()+e}}),e)},ep=function(e){q(function(t){return[].concat((0,i.Z)(t),(0,i.Z)(e))})};return(0,d.useImperativeHandle)(t,function(){return{addFile:ep}}),(0,d.useEffect)(function(){var e=ee.current;return function(){et.forEach(function(t){"file"===t.type&&t.src&&(null==e||e.revokeObjectURL(t.src))})}},[et]),(0,d.useEffect)(function(){!Y.length&&U.current&&(U.current.value="")},[Y]),(0,d.useEffect)(function(){O&&et.length&&ec(),eo(function(e){var t={};return et.forEach(function(n){t[n.id]=e[n.id]||"WAIT"}),t})},[et,O]),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(y,w(w({ref:T,className:"con_input_wrap".concat(Z?" ".concat(Z):"")},A),{},{onClick:function(){return L&&_&&ei()},onDrop:function(e){var t;e.preventDefault(),e.stopPropagation(),(null===(t=e.dataTransfer.files)||void 0===t?void 0:t.length)&&q(function(t){return[].concat((0,i.Z)(t),(0,i.Z)(Array.from(e.dataTransfer.files)))})},onDragOver:function(e){return e.preventDefault()},children:[Array.isArray(x)?(0,d.cloneElement)(x[0],w(w({},x[0].props),{},{className:"upload_children_wrap ".concat(x[0].props.className||"").concat(et.length?" hide":"")})):(0,d.cloneElement)(x,w(w({},x.props),{},{className:"upload_children_wrap ".concat(x.props.className||"").concat(et.length?" hide":"")})),(0,g.jsx)("input",{ref:U,type:"file",name:"",id:"",multiple:!0,accept:"image/*",style:{display:"none"},onChange:function(e){var t;(null===(t=e.target.files)||void 0===t?void 0:t.length)&&q((0,i.Z)(Array.from(e.target.files)))}}),(0,g.jsx)("div",{className:"scroll_er tmp_wrap",children:et.map(function(e,t){return(0,g.jsxs)("div",{className:"tmp_item_wrap upload_".concat(er[e.id]),onClick:function(e){return e.stopPropagation()},children:[(0,g.jsx)("img",{className:"tmp_item",width:"40",height:"96",src:e.src,alt:"",onClick:function(){return eu(t)}}),K||(0,g.jsx)(m.Z,{className:"tmp_del_btn",type:"close",onClick:function(){return es(e,t)}}),{SUCCESS:(0,g.jsx)(m.Z,{className:"tmp_status_btn",type:"yes",fill:"green"}),ERROR:(0,g.jsx)(m.Z,{className:"tmp_status_btn",type:"no",fill:"red"}),WAIT:"",LOADING:(0,g.jsx)(m.Z,{className:"tmp_status_btn rotate",type:"loading",fill:"gray"})}[er[e.id]]]},e.id)})}),(0,g.jsxs)("div",{className:"up_operate_".concat(void 0===z?"bottom":z),children:[(0,g.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[L&&_||(0,g.jsx)(m.Z,{width:26,type:"image",style:{marginRight:"10px"},onClick:ei}),(void 0===C||C)&&(0,g.jsxs)("div",{className:"url_input_wrap",onClick:function(e){return e.stopPropagation()},children:[(0,g.jsx)("input",{className:"normal_input url_input",type:"text",placeholder:"".concat(et.length||0," pics will be uploaded"),value:V,onInput:function(e){return W(e.currentTarget.value)},onKeyUp:function(e){"Enter"===e.key&&el()}}),(0,g.jsx)(m.Z,{className:"enter_icon",type:"enter",onClick:el})]})]}),O||!!et.length&&(0,g.jsx)("button",{className:"normal_btn submit_btn",onClick:ec,children:"upload"}),Array.isArray(x)?(0,d.cloneElement)(x[1],w({},x[1].props)):""]})]})),(0,g.jsx)(h.Z,{ref:$,slice:!1})]})});_.displayName="ImgUpload",t.Z=_},2999:function(e,t,n){var r=n(9499),o=n(4730),i=n(7294),a=n(5893),c=n(3454),l=["loadingPic","src","className","beforeLoad","onLoad","noReload","children","isShow"];function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.Z=function(e){var t=e.loadingPic,n=e.src,u=e.className,p=(e.beforeLoad,e.onLoad),d=void 0===p?function(e){return Promise.resolve(e)}:p,f=e.noReload,m=void 0!==f&&f,h=e.children,g=e.isShow,b=void 0===g||g,v=(0,o.Z)(e,l),w=(0,i.useRef)(t||"https://wsrv.nl/?url=raw.githubusercontent.com/mirrows/photo/main/normal/2023_09_10/pic1694333133502339.gif&w=130&fit=cover&n=-1&q=80"),y=(0,i.useRef)(c.env.NEXT_FAIL_IMG),_=(0,i.useState)(w.current),x=_[0],j=_[1],O=(0,i.useState)(!1),k=O[0],R=O[1],S=(0,i.useRef)(null),P=(0,i.useRef)(0);return(0,i.useEffect)(function(){if(!P.current){var e,t,r=document.documentElement.clientHeight,o=document.documentElement.clientWidth;m||null===(e=S.current)||void 0===e||e.classList.add("lazy"),R(!1),S.current&&!(S.current.getBoundingClientRect().top<-S.current.clientHeight||S.current.getBoundingClientRect().top>1.5*r)&&!(S.current.getBoundingClientRect().left<-o||S.current.getBoundingClientRect().left>1.5*o)&&S.current.getBoundingClientRect().width&&S.current.getBoundingClientRect().height&&b&&(m&&(P.current=1),null===(t=S.current)||void 0===t||t.classList.remove("lazy"),j(n))}},[n,b,m]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("img",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({className:"".concat(u?"lazy ".concat(u):"lazy"),ref:S,src:x,"data-src":n,alt:"",onLoad:function(){var e;R(!0),n===(null===(e=S.current)||void 0===e?void 0:e.src)&&d(n)},onError:function(){var e;null===(e=S.current)||void 0===e||e.classList.add("lazy"),j(y.current),R(!0)}},v)),k||h]})}},3243:function(e,t,n){var r=n(2379),o=n(2999),i=n(9521),a=n(7294),c=n(3290),l=n(7989),s=n(3806);n(995);var u=n(5893),p=i.ZP.div.withConfig({displayName:"PicModal__PIC",componentId:"sc-l89lay-0"})(["&.imgs_wrap{position:fixed;top:0;bottom:0;left:0;right:0;background-color:#666;z-index:-10;opacity:0;transition:.3s;}.pic_wrap{display:flex;justify-content:center;align-items:center;padding:30px;margin:auto;box-sizing:border-box;}.pic_item{width:unset;height:unset;max-width:100%;max-height:100%;}.swiper_header{display:flex;flex-wrap:nowrap;justify-content:space-between;align-items:center;position:absolute;top:0;left:0;width:100%;height:fit-content;padding:10px;background-image:linear-gradient(black 0%,transparent 80%);box-sizing:border-box;color:#fff;z-index:80;.name{line-height:1;}}.modal_wrap{}.img_swiper_wrap{width:100%;height:100%;}.img_swiper_wrap .tmp_status_btn{position:absolute;width:64px;z-index:-1;}&.flow_up{opacity:1;z-index:60;}"]),d=(0,a.forwardRef)(function(e,t){var n,i=e.pics,d=e.slice,f=void 0===d||d,m=e.onChange,h=void 0===m?function(){}:m,g=e.beforeLoad,b=void 0===g?function(e){return Promise.resolve(e)}:g,v=(0,a.useState)(!1),w=v[0],y=v[1],_=(0,a.useRef)(null),x=(0,a.useState)(0),j=x[0],O=x[1],k=(0,a.useState)(!1),R=k[0],S=k[1],P=(0,c.wo)(".img_swiper_wrap .lazy").emit,N=(0,a.useState)(i||[]),E=N[0],D=N[1],Z=(0,a.useRef)({obj:"body",val:0}),C=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;D(e),O(n),_.current?(null===(t=_.current)||void 0===t||t.slideTo(n),setTimeout(function(){y(!0)},300)):setTimeout(function(){var e;null===(e=_.current)||void 0===e||e.slideTo(n),setTimeout(function(){y(!0)},2e3)},500)},I=function(){D([]),y(!1)};return(0,a.useImperativeHandle)(t,function(){return{open:C,close:I}}),(0,a.useEffect)(function(){i&&D(i)},[i]),(0,a.useEffect)(function(){S((0,l.tq)())},[]),(0,a.useEffect)(function(){if(w)document.body.scrollTop?Z.current={obj:"body",val:document.body.scrollTop}:document.documentElement.scrollTop&&(Z.current={obj:"documentElement",val:document.documentElement.scrollTop}),document.body.classList.add("disabled_scroll"),P();else{if(D([]),document.body.classList.remove("disabled_scroll"),!Z.current.val)return;document[Z.current.obj].scrollTop=Z.current.val,Z.current.val=0}},[w,P]),(0,u.jsxs)(p,{className:"imgs_wrap".concat(w?" flow_up":""),onScroll:function(e){e.stopPropagation()},onWheel:function(e){e.stopPropagation()},children:[(0,u.jsxs)("div",{className:"swiper_header",children:[(0,u.jsx)("span",{className:"name",children:(null===(n=E[j])||void 0===n?void 0:n.name)||""}),(0,u.jsx)(s.Z,{type:"close",width:"30",height:"30",fill:"#fff",className:"close_swiper",onClick:function(){return y(!1)}})]}),(0,u.jsx)(r.tq,{loop:!0,className:"img_swiper_wrap",onSwiper:function(e){return _.current=e},onSlideChangeTransitionEnd:function(e){O(e.realIndex),h(),P()},children:E.map(function(e,t){return(0,u.jsx)(r.o5,{className:"pic_wrap",children:(0,u.jsx)(o.Z,{src:f?"https://wsrv.nl/?url=".concat((e.preview_url||e.download_url||"").replace("https://","")).concat(R?"&w=240":"","&n=-1&q=80"):e.cdn_url||"",className:"pic_item",width:"1920",height:"1080",alt:"bing",beforeLoad:b,children:(0,u.jsx)(s.Z,{className:"tmp_status_btn rotate",type:"loading",fill:"#fff"})})},t)})})]})});d.displayName="PicModal",t.Z=d},7167:function(e,t,n){n.d(t,{Is:function(){return m},P_:function(){return p},VD:function(){return o},Zb:function(){return d},iS:function(){return u},yJ:function(){return f}});var r,o,i=n(9499),a=n(842),c=n(8984);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}(r=o||(o={})).PHOTO="photo",r.PRIVATE="private";var u=function(e){return(0,a.IO)({path:"/demos/uploadBase64",method:"put",headers:s({timestamp:Date.now(),"content-type":"application/json"},c.SR.data.token?{Authorization:"token ".concat(c.SR.data.token)}:{}),params:e})},p=function(e){return(0,a.IO)({path:"/demos/uploadUrl",method:"put",headers:s({timestamp:Date.now(),"content-type":"application/json"},c.SR.data.token?{Authorization:"token ".concat(c.SR.data.token)}:{}),params:e})},d=function(e,t){return(0,a.IO)({path:"/demos/queryPicList",method:"post",headers:s({"content-type":"application/json"},c.SR.data.token?{Authorization:"token ".concat(c.SR.data.token)}:{}),params:{path:e,mode:t}})},f=function(e,t){return(0,a.IO)({path:"/demos/queryPic",method:"post",headers:s({"content-type":"application/json"},c.SR.data.token?{Authorization:"token ".concat(c.SR.data.token)}:{}),params:{path:e,mode:t}})},m=function(e){return(0,a.IO)({path:"/demos/deletePic",method:"post",headers:s({timestamp:Date.now(),"content-type":"application/json"},c.SR.data.token?{Authorization:"token ".concat(c.SR.data.token)}:{}),params:e})}}}]);